(function () {

  angular.module('Podic.services').service('PokemonRequest', PokemonRequest);
  var protoStrings = {
    "enums": "enum ActivityType {\n\tACTIVITY_UNKNOWN = 0;\n\tACTIVITY_CATCH_POKEMON = 1;\n\tACTIVITY_CATCH_LEGEND_POKEMON = 2;\n\tACTIVITY_FLEE_POKEMON = 3;\n\tACTIVITY_DEFEAT_FORT = 4;\n\tACTIVITY_EVOLVE_POKEMON = 5;\n\tACTIVITY_HATCH_EGG = 6;\n\tACTIVITY_WALK_KM = 7;\n\tACTIVITY_POKEDEX_ENTRY_NEW = 8;\n\tACTIVITY_CATCH_FIRST_THROW = 9;\n\tACTIVITY_CATCH_NICE_THROW = 10;\n\tACTIVITY_CATCH_GREAT_THROW = 11;\n\tACTIVITY_CATCH_EXCELLENT_THROW = 12;\n\tACTIVITY_CATCH_CURVEBALL = 13;\n\tACTIVITY_CATCH_FIRST_CATCH_OF_DAY = 14;\n\tACTIVITY_CATCH_MILESTONE = 15;\n\tACTIVITY_TRAIN_POKEMON = 16;\n\tACTIVITY_SEARCH_FORT = 17;\n\tACTIVITY_RELEASE_POKEMON = 18;\n\tACTIVITY_HATCH_EGG_SMALL_BONUS = 19;\n\tACTIVITY_HATCH_EGG_MEDIUM_BONUS = 20;\n\tACTIVITY_HATCH_EGG_LARGE_BONUS = 21;\n\tACTIVITY_DEFEAT_GYM_DEFENDER = 22;\n\tACTIVITY_DEFEAT_GYM_LEADER = 23;\n}\nenum BadgeType {\n\tBADGE_UNSET = 0;\n\tBADGE_TRAVEL_KM = 1;\n\tBADGE_POKEDEX_ENTRIES = 2;\n\tBADGE_CAPTURE_TOTAL = 3;\n\tBADGE_DEFEATED_FORT = 4;\n\tBADGE_EVOLVED_TOTAL = 5;\n\tBADGE_HATCHED_TOTAL = 6;\n\tBADGE_ENCOUNTERED_TOTAL = 7;\n\tBADGE_POKESTOPS_VISITED = 8;\n\tBADGE_UNIQUE_POKESTOPS = 9;\n\tBADGE_POKEBALL_THROWN = 10;\n\tBADGE_BIG_MAGIKARP = 11;\n\tBADGE_DEPLOYED_TOTAL = 12;\n\tBADGE_BATTLE_ATTACK_WON = 13;\n\tBADGE_BATTLE_TRAINING_WON = 14;\n\tBADGE_BATTLE_DEFEND_WON = 15;\n\tBADGE_PRESTIGE_RAISED = 16;\n\tBADGE_PRESTIGE_DROPPED = 17;\n\tBADGE_TYPE_NORMAL = 18;\n\tBADGE_TYPE_FIGHTING = 19;\n\tBADGE_TYPE_FLYING = 20;\n\tBADGE_TYPE_POISON = 21;\n\tBADGE_TYPE_GROUND = 22;\n\tBADGE_TYPE_ROCK = 23;\n\tBADGE_TYPE_BUG = 24;\n\tBADGE_TYPE_GHOST = 25;\n\tBADGE_TYPE_STEEL = 26;\n\tBADGE_TYPE_FIRE = 27;\n\tBADGE_TYPE_WATER = 28;\n\tBADGE_TYPE_GRASS = 29;\n\tBADGE_TYPE_ELECTRIC = 30;\n\tBADGE_TYPE_PSYCHIC = 31;\n\tBADGE_TYPE_ICE = 32;\n\tBADGE_TYPE_DRAGON = 33;\n\tBADGE_TYPE_DARK = 34;\n\tBADGE_TYPE_FAIRY = 35;\n\tBADGE_SMALL_RATTATA = 36;\n\tBADGE_PIKACHU = 37;\n}\nenum CameraInterpolation {\n\tCAM_INTERP_CUT = 0;\n\tCAM_INTERP_LINEAR = 1;\n\tCAM_INTERP_SMOOTH = 2;\n\tCAM_INTERP_SMOOTH_ROT_LINEAR_MOVE = 3;\n\tCAM_INTERP_DEPENDS = 4;\n}\nenum CameraTarget {\n\tCAM_TARGET_ATTACKER = 0;\n\tCAM_TARGET_ATTACKER_EDGE = 1;\n\tCAM_TARGET_ATTACKER_GROUND = 2;\n\tCAM_TARGET_DEFENDER = 3;\n\tCAM_TARGET_DEFENDER_EDGE = 4;\n\tCAM_TARGET_DEFENDER_GROUND = 5;\n\tCAM_TARGET_ATTACKER_DEFENDER = 6;\n\tCAM_TARGET_ATTACKER_DEFENDER_EDGE = 7;\n\tCAM_TARGET_DEFENDER_ATTACKER = 8;\n\tCAM_TARGET_DEFENDER_ATTACKER_EDGE = 9;\n\tCAM_TARGET_ATTACKER_DEFENDER_MIRROR = 11;\n\tCAM_TARGET_SHOULDER_ATTACKER_DEFENDER = 12;\n\tCAM_TARGET_SHOULDER_ATTACKER_DEFENDER_MIRROR = 13;\n\tCAM_TARGET_ATTACKER_DEFENDER_WORLD = 14;\n}\nenum Gender {\n\tMALE = 0;\n\tFEMALE = 1;\n}\nenum HoloIapItemCategory {\n\tIAP_CATEGORY_NONE = 0;\n\tIAP_CATEGORY_BUNDLE = 1;\n\tIAP_CATEGORY_ITEMS = 2;\n\tIAP_CATEGORY_UPGRADES = 3;\n\tIAP_CATEGORY_POKECOINS = 4;\n}\nenum ItemCategory {\n\tITEM_CATEGORY_NONE = 0;\n\tITEM_CATEGORY_POKEBALL = 1;\n\tITEM_CATEGORY_FOOD = 2;\n\tITEM_CATEGORY_MEDICINE = 3;\n\tITEM_CATEGORY_BOOST = 4;\n\tITEM_CATEGORY_UTILITES = 5;\n\tITEM_CATEGORY_CAMERA = 6;\n\tITEM_CATEGORY_DISK = 7;\n\tITEM_CATEGORY_INCUBATOR = 8;\n\tITEM_CATEGORY_INCENSE = 9;\n\tITEM_CATEGORY_XP_BOOST = 10;\n\tITEM_CATEGORY_INVENTORY_UPGRADE = 11;\n}\nenum ItemEffect {\n\tITEM_EFFECT_NONE = 0;\n\tITEM_EFFECT_CAP_NO_FLEE = 1000;\n\tITEM_EFFECT_CAP_NO_MOVEMENT = 1002;\n\tITEM_EFFECT_CAP_NO_THREAT = 1003;\n\tITEM_EFFECT_CAP_TARGET_MAX = 1004;\n\tITEM_EFFECT_CAP_TARGET_SLOW = 1005;\n\tITEM_EFFECT_CAP_CHANCE_NIGHT = 1006;\n\tITEM_EFFECT_CAP_CHANCE_TRAINER = 1007;\n\tITEM_EFFECT_CAP_CHANCE_FIRST_THROW = 1008;\n\tITEM_EFFECT_CAP_CHANCE_LEGEND = 1009;\n\tITEM_EFFECT_CAP_CHANCE_HEAVY = 1010;\n\tITEM_EFFECT_CAP_CHANCE_REPEAT = 1011;\n\tITEM_EFFECT_CAP_CHANCE_MULTI_THROW = 1012;\n\tITEM_EFFECT_CAP_CHANCE_ALWAYS = 1013;\n\tITEM_EFFECT_CAP_CHANCE_SINGLE_THROW = 1014;\n}\nenum Platform {\n\tUNSET = 0;\n\tIOS = 1;\n\tANDROID = 2;\n\tOSX = 3;\n\tWINDOWS = 4;\n}\nenum PokemonClass {\n\tNORMAL = 0;\n\tLEGENDARY = 1;\n\tMYTHIC = 2;\n}\nenum PokemonFamilyId {\n\tFAMILY_UNSET = 0;\n\tFAMILY_BULBASAUR = 1;\n\tFAMILY_CHARMANDER = 4;\n\tFAMILY_SQUIRTLE = 7;\n\tFAMILY_CATERPIE = 10;\n\tFAMILY_WEEDLE = 13;\n\tFAMILY_PIDGEY = 16;\n\tFAMILY_RATTATA = 19;\n\tFAMILY_SPEAROW = 21;\n\tFAMILY_EKANS = 23;\n\tFAMILY_PIKACHU = 25;\n\tFAMILY_SANDSHREW = 27;\n\tFAMILY_NIDORAN_FEMALE = 29;\n\tFAMILY_NIDORAN_MALE = 32;\n\tFAMILY_CLEFAIRY = 35;\n\tFAMILY_VULPIX = 37;\n\tFAMILY_JIGGLYPUFF = 39;\n\tFAMILY_ZUBAT = 41;\n\tFAMILY_ODDISH = 43;\n\tFAMILY_PARAS = 46;\n\tFAMILY_VENONAT = 48;\n\tFAMILY_DIGLETT = 50;\n\tFAMILY_MEOWTH = 52;\n\tFAMILY_PSYDUCK = 54;\n\tFAMILY_MANKEY = 56;\n\tFAMILY_GROWLITHE = 58;\n\tFAMILY_POLIWAG = 60;\n\tFAMILY_ABRA = 63;\n\tFAMILY_MACHOP = 66;\n\tFAMILY_BELLSPROUT = 69;\n\tFAMILY_TENTACOOL = 72;\n\tFAMILY_GEODUDE = 74;\n\tFAMILY_PONYTA = 77;\n\tFAMILY_SLOWPOKE = 79;\n\tFAMILY_MAGNEMITE = 81;\n\tFAMILY_FARFETCHD = 83;\n\tFAMILY_DODUO = 84;\n\tFAMILY_SEEL = 86;\n\tFAMILY_GRIMER = 88;\n\tFAMILY_SHELLDER = 90;\n\tFAMILY_GASTLY = 92;\n\tFAMILY_ONIX = 95;\n\tFAMILY_DROWZEE = 96;\n\tFAMILY_HYPNO = 97;\n\tFAMILY_KRABBY = 98;\n\tFAMILY_VOLTORB = 100;\n\tFAMILY_EXEGGCUTE = 102;\n\tFAMILY_CUBONE = 104;\n\tFAMILY_HITMONLEE = 106;\n\tFAMILY_HITMONCHAN = 107;\n\tFAMILY_LICKITUNG = 108;\n\tFAMILY_KOFFING = 109;\n\tFAMILY_RHYHORN = 111;\n\tFAMILY_CHANSEY = 113;\n\tFAMILY_TANGELA = 114;\n\tFAMILY_KANGASKHAN = 115;\n\tFAMILY_HORSEA = 116;\n\tFAMILY_GOLDEEN = 118;\n\tFAMILY_STARYU = 120;\n\tFAMILY_MR_MIME = 122;\n\tFAMILY_SCYTHER = 123;\n\tFAMILY_JYNX = 124;\n\tFAMILY_ELECTABUZZ = 125;\n\tFAMILY_MAGMAR = 126;\n\tFAMILY_PINSIR = 127;\n\tFAMILY_TAUROS = 128;\n\tFAMILY_MAGIKARP = 129;\n\tFAMILY_LAPRAS = 131;\n\tFAMILY_DITTO = 132;\n\tFAMILY_EEVEE = 133;\n\tFAMILY_PORYGON = 137;\n\tFAMILY_OMANYTE = 138;\n\tFAMILY_KABUTO = 140;\n\tFAMILY_AERODACTYL = 142;\n\tFAMILY_SNORLAX = 143;\n\tFAMILY_ARTICUNO = 144;\n\tFAMILY_ZAPDOS = 145;\n\tFAMILY_MOLTRES = 146;\n\tFAMILY_DRATINI = 147;\n\tFAMILY_MEWTWO = 150;\n\tFAMILY_MEW = 151;\n}\nenum PokemonId {\n\tMISSINGNO = 0;\n\tBULBASAUR = 1;\n\tIVYSAUR = 2;\n\tVENUSAUR = 3;\n\tCHARMANDER = 4;\n\tCHARMELEON = 5;\n\tCHARIZARD = 6;\n\tSQUIRTLE = 7;\n\tWARTORTLE = 8;\n\tBLASTOISE = 9;\n\tCATERPIE = 10;\n\tMETAPOD = 11;\n\tBUTTERFREE = 12;\n\tWEEDLE = 13;\n\tKAKUNA = 14;\n\tBEEDRILL = 15;\n\tPIDGEY = 16;\n\tPIDGEOTTO = 17;\n\tPIDGEOT = 18;\n\tRATTATA = 19;\n\tRATICATE = 20;\n\tSPEAROW = 21;\n\tFEAROW = 22;\n\tEKANS = 23;\n\tARBOK = 24;\n\tPIKACHU = 25;\n\tRAICHU = 26;\n\tSANDSHREW = 27;\n\tSANDSLASH = 28;\n\tNIDORAN_FEMALE = 29;\n\tNIDORINA = 30;\n\tNIDOQUEEN = 31;\n\tNIDORAN_MALE = 32;\n\tNIDORINO = 33;\n\tNIDOKING = 34;\n\tCLEFAIRY = 35;\n\tCLEFABLE = 36;\n\tVULPIX = 37;\n\tNINETALES = 38;\n\tJIGGLYPUFF = 39;\n\tWIGGLYTUFF = 40;\n\tZUBAT = 41;\n\tGOLBAT = 42;\n\tODDISH = 43;\n\tGLOOM = 44;\n\tVILEPLUME = 45;\n\tPARAS = 46;\n\tPARASECT = 47;\n\tVENONAT = 48;\n\tVENOMOTH = 49;\n\tDIGLETT = 50;\n\tDUGTRIO = 51;\n\tMEOWTH = 52;\n\tPERSIAN = 53;\n\tPSYDUCK = 54;\n\tGOLDUCK = 55;\n\tMANKEY = 56;\n\tPRIMEAPE = 57;\n\tGROWLITHE = 58;\n\tARCANINE = 59;\n\tPOLIWAG = 60;\n\tPOLIWHIRL = 61;\n\tPOLIWRATH = 62;\n\tABRA = 63;\n\tKADABRA = 64;\n\tALAKAZAM = 65;\n\tMACHOP = 66;\n\tMACHOKE = 67;\n\tMACHAMP = 68;\n\tBELLSPROUT = 69;\n\tWEEPINBELL = 70;\n\tVICTREEBEL = 71;\n\tTENTACOOL = 72;\n\tTENTACRUEL = 73;\n\tGEODUDE = 74;\n\tGRAVELER = 75;\n\tGOLEM = 76;\n\tPONYTA = 77;\n\tRAPIDASH = 78;\n\tSLOWPOKE = 79;\n\tSLOWBRO = 80;\n\tMAGNEMITE = 81;\n\tMAGNETON = 82;\n\tFARFETCHD = 83;\n\tDODUO = 84;\n\tDODRIO = 85;\n\tSEEL = 86;\n\tDEWGONG = 87;\n\tGRIMER = 88;\n\tMUK = 89;\n\tSHELLDER = 90;\n\tCLOYSTER = 91;\n\tGASTLY = 92;\n\tHAUNTER = 93;\n\tGENGAR = 94;\n\tONIX = 95;\n\tDROWZEE = 96;\n\tHYPNO = 97;\n\tKRABBY = 98;\n\tKINGLER = 99;\n\tVOLTORB = 100;\n\tELECTRODE = 101;\n\tEXEGGCUTE = 102;\n\tEXEGGUTOR = 103;\n\tCUBONE = 104;\n\tMAROWAK = 105;\n\tHITMONLEE = 106;\n\tHITMONCHAN = 107;\n\tLICKITUNG = 108;\n\tKOFFING = 109;\n\tWEEZING = 110;\n\tRHYHORN = 111;\n\tRHYDON = 112;\n\tCHANSEY = 113;\n\tTANGELA = 114;\n\tKANGASKHAN = 115;\n\tHORSEA = 116;\n\tSEADRA = 117;\n\tGOLDEEN = 118;\n\tSEAKING = 119;\n\tSTARYU = 120;\n\tSTARMIE = 121;\n\tMR_MIME = 122;\n\tSCYTHER = 123;\n\tJYNX = 124;\n\tELECTABUZZ = 125;\n\tMAGMAR = 126;\n\tPINSIR = 127;\n\tTAUROS = 128;\n\tMAGIKARP = 129;\n\tGYARADOS = 130;\n\tLAPRAS = 131;\n\tDITTO = 132;\n\tEEVEE = 133;\n\tVAPOREON = 134;\n\tJOLTEON = 135;\n\tFLAREON = 136;\n\tPORYGON = 137;\n\tOMANYTE = 138;\n\tOMASTAR = 139;\n\tKABUTO = 140;\n\tKABUTOPS = 141;\n\tAERODACTYL = 142;\n\tSNORLAX = 143;\n\tARTICUNO = 144;\n\tZAPDOS = 145;\n\tMOLTRES = 146;\n\tDRATINI = 147;\n\tDRAGONAIR = 148;\n\tDRAGONITE = 149;\n\tMEWTWO = 150;\n\tMEW = 151;\n}\nenum PokemonMove {\n\tMOVE_UNSET = 0;\n\tTHUNDER_SHOCK = 1;\n\tQUICK_ATTACK = 2;\n\tSCRATCH = 3;\n\tEMBER = 4;\n\tVINE_WHIP = 5;\n\tTACKLE = 6;\n\tRAZOR_LEAF = 7;\n\tTAKE_DOWN = 8;\n\tWATER_GUN = 9;\n\tBITE = 10;\n\tPOUND = 11;\n\tDOUBLE_SLAP = 12;\n\tWRAP = 13;\n\tHYPER_BEAM = 14;\n\tLICK = 15;\n\tDARK_PULSE = 16;\n\tSMOG = 17;\n\tSLUDGE = 18;\n\tMETAL_CLAW = 19;\n\tVICE_GRIP = 20;\n\tFLAME_WHEEL = 21;\n\tMEGAHORN = 22;\n\tWING_ATTACK = 23;\n\tFLAMETHROWER = 24;\n\tSUCKER_PUNCH = 25;\n\tDIG = 26;\n\tLOW_KICK = 27;\n\tCROSS_CHOP = 28;\n\tPSYCHO_CUT = 29;\n\tPSYBEAM = 30;\n\tEARTHQUAKE = 31;\n\tSTONE_EDGE = 32;\n\tICE_PUNCH = 33;\n\tHEART_STAMP = 34;\n\tDISCHARGE = 35;\n\tFLASH_CANNON = 36;\n\tPECK = 37;\n\tDRILL_PECK = 38;\n\tICE_BEAM = 39;\n\tBLIZZARD = 40;\n\tAIR_SLASH = 41;\n\tHEAT_WAVE = 42;\n\tTWINEEDLE = 43;\n\tPOISON_JAB = 44;\n\tAERIAL_ACE = 45;\n\tDRILL_RUN = 46;\n\tPETAL_BLIZZARD = 47;\n\tMEGA_DRAIN = 48;\n\tBUG_BUZZ = 49;\n\tPOISON_FANG = 50;\n\tNIGHT_SLASH = 51;\n\tSLASH = 52;\n\tBUBBLE_BEAM = 53;\n\tSUBMISSION = 54;\n\tKARATE_CHOP = 55;\n\tLOW_SWEEP = 56;\n\tAQUA_JET = 57;\n\tAQUA_TAIL = 58;\n\tSEED_BOMB = 59;\n\tPSYSHOCK = 60;\n\tROCK_THROW = 61;\n\tANCIENT_POWER = 62;\n\tROCK_TOMB = 63;\n\tROCK_SLIDE = 64;\n\tPOWER_GEM = 65;\n\tSHADOW_SNEAK = 66;\n\tSHADOW_PUNCH = 67;\n\tSHADOW_CLAW = 68;\n\tOMINOUS_WIND = 69;\n\tSHADOW_BALL = 70;\n\tBULLET_PUNCH = 71;\n\tMAGNET_BOMB = 72;\n\tSTEEL_WING = 73;\n\tIRON_HEAD = 74;\n\tPARABOLIC_CHARGE = 75;\n\tSPARK = 76;\n\tTHUNDER_PUNCH = 77;\n\tTHUNDER = 78;\n\tTHUNDERBOLT = 79;\n\tTWISTER = 80;\n\tDRAGON_BREATH = 81;\n\tDRAGON_PULSE = 82;\n\tDRAGON_CLAW = 83;\n\tDISARMING_VOICE = 84;\n\tDRAINING_KISS = 85;\n\tDAZZLING_GLEAM = 86;\n\tMOONBLAST = 87;\n\tPLAY_ROUGH = 88;\n\tCROSS_POISON = 89;\n\tSLUDGE_BOMB = 90;\n\tSLUDGE_WAVE = 91;\n\tGUNK_SHOT = 92;\n\tMUD_SHOT = 93;\n\tBONE_CLUB = 94;\n\tBULLDOZE = 95;\n\tMUD_BOMB = 96;\n\tFURY_CUTTER = 97;\n\tBUG_BITE = 98;\n\tSIGNAL_BEAM = 99;\n\tX_SCISSOR = 100;\n\tFLAME_CHARGE = 101;\n\tFLAME_BURST = 102;\n\tFIRE_BLAST = 103;\n\tBRINE = 104;\n\tWATER_PULSE = 105;\n\tSCALD = 106;\n\tHYDRO_PUMP = 107;\n\tPSYCHIC = 108;\n\tPSYSTRIKE = 109;\n\tICE_SHARD = 110;\n\tICY_WIND = 111;\n\tFROST_BREATH = 112;\n\tABSORB = 113;\n\tGIGA_DRAIN = 114;\n\tFIRE_PUNCH = 115;\n\tSOLAR_BEAM = 116;\n\tLEAF_BLADE = 117;\n\tPOWER_WHIP = 118;\n\tSPLASH = 119;\n\tACID = 120;\n\tAIR_CUTTER = 121;\n\tHURRICANE = 122;\n\tBRICK_BREAK = 123;\n\tCUT = 124;\n\tSWIFT = 125;\n\tHORN_ATTACK = 126;\n\tSTOMP = 127;\n\tHEADBUTT = 128;\n\tHYPER_FANG = 129;\n\tSLAM = 130;\n\tBODY_SLAM = 131;\n\tREST = 132;\n\tSTRUGGLE = 133;\n\tSCALD_BLASTOISE = 134;\n\tHYDRO_PUMP_BLASTOISE = 135;\n\tWRAP_GREEN = 136;\n\tWRAP_PINK = 137;\n\tFURY_CUTTER_FAST = 200;\n\tBUG_BITE_FAST = 201;\n\tBITE_FAST = 202;\n\tSUCKER_PUNCH_FAST = 203;\n\tDRAGON_BREATH_FAST = 204;\n\tTHUNDER_SHOCK_FAST = 205;\n\tSPARK_FAST = 206;\n\tLOW_KICK_FAST = 207;\n\tKARATE_CHOP_FAST = 208;\n\tEMBER_FAST = 209;\n\tWING_ATTACK_FAST = 210;\n\tPECK_FAST = 211;\n\tLICK_FAST = 212;\n\tSHADOW_CLAW_FAST = 213;\n\tVINE_WHIP_FAST = 214;\n\tRAZOR_LEAF_FAST = 215;\n\tMUD_SHOT_FAST = 216;\n\tICE_SHARD_FAST = 217;\n\tFROST_BREATH_FAST = 218;\n\tQUICK_ATTACK_FAST = 219;\n\tSCRATCH_FAST = 220;\n\tTACKLE_FAST = 221;\n\tPOUND_FAST = 222;\n\tCUT_FAST = 223;\n\tPOISON_JAB_FAST = 224;\n\tACID_FAST = 225;\n\tPSYCHO_CUT_FAST = 226;\n\tROCK_THROW_FAST = 227;\n\tMETAL_CLAW_FAST = 228;\n\tBULLET_PUNCH_FAST = 229;\n\tWATER_GUN_FAST = 230;\n\tSPLASH_FAST = 231;\n\tWATER_GUN_FAST_BLASTOISE = 232;\n\tMUD_SLAP_FAST = 233;\n\tZEN_HEADBUTT_FAST = 234;\n\tCONFUSION_FAST = 235;\n\tPOISON_STING_FAST = 236;\n\tBUBBLE_FAST = 237;\n\tFEINT_ATTACK_FAST = 238;\n\tSTEEL_WING_FAST = 239;\n\tFIRE_FANG_FAST = 240;\n\tROCK_SMASH_FAST = 241;\n}\nenum PokemonMovementType {\n\tMOVEMENT_STATIC = 0;\n\tMOVEMENT_JUMP = 1;\n\tMOVEMENT_VERTICAL = 2;\n\tMOVEMENT_PSYCHIC = 3;\n\tMOVEMENT_ELECTRIC = 4;\n\tMOVEMENT_FLYING = 5;\n\tMOVEMENT_HOVERING = 6;\n}\nenum PokemonType {\n\tPOKEMON_TYPE_NONE = 0;\n\tPOKEMON_TYPE_NORMAL = 1;\n\tPOKEMON_TYPE_FIGHTING = 2;\n\tPOKEMON_TYPE_FLYING = 3;\n\tPOKEMON_TYPE_POISON = 4;\n\tPOKEMON_TYPE_GROUND = 5;\n\tPOKEMON_TYPE_ROCK = 6;\n\tPOKEMON_TYPE_BUG = 7;\n\tPOKEMON_TYPE_GHOST = 8;\n\tPOKEMON_TYPE_STEEL = 9;\n\tPOKEMON_TYPE_FIRE = 10;\n\tPOKEMON_TYPE_WATER = 11;\n\tPOKEMON_TYPE_GRASS = 12;\n\tPOKEMON_TYPE_ELECTRIC = 13;\n\tPOKEMON_TYPE_PSYCHIC = 14;\n\tPOKEMON_TYPE_ICE = 15;\n\tPOKEMON_TYPE_DRAGON = 16;\n\tPOKEMON_TYPE_DARK = 17;\n\tPOKEMON_TYPE_FAIRY = 18;\n}\nenum TeamColor {\n\tNEUTRAL = 0;\n\tBLUE = 1;\n\tRED = 2;\n\tYELLOW = 3;\n}\nenum TutorialState {\n\tLEGAL_SCREEN = 0;\n\tAVATAR_SELECTION = 1;\n\tACCOUNT_CREATION = 2;\n\tPOKEMON_CAPTURE = 3;\n\tNAME_SELECTION = 4;\n\tPOKEMON_BERRY = 5;\n\tUSE_ITEM = 6;\n\tFIRST_TIME_EXPERIENCE_COMPLETE = 7;\n\tPOKESTOP_TUTORIAL = 8;\n\tGYM_TUTORIAL = 9;\n}\n",
    "request": "message RequestEnvelope {\n\trequired int32 status_code = 1;\n\n\trequired uint64 request_id = 3;\n\trepeated Request requests = 4;\n\n\toptional Unknown6 unknown6 = 6;\n\trequired double latitude = 7;\n\trequired double longitude = 8;\n\trequired double altitude = 9;\n\trequired AuthInfo auth_info = 10;\n\toptional AuthTicket auth_ticket = 11;\n\toptional int64 unknown12 = 12;\n\n  message Unknown6 {\n  \trequired int32 unknown1 = 1; //6\n  \trequired Unknown2 unknown2 = 2;\n\n\t  message Unknown2 {\n  \t\trequired bytes unknown1 = 1;\n  \t}\n  }\n\n  message AuthTicket {\n  \trequired bytes start = 1;\n  \toptional uint64 expire_timestamp_ms = 2;\n  \trequired bytes end = 3;\n  }\n\n\tmessage AuthInfo {\n\t\trequired string provider = 1;\n\t\trequired JWT token = 2;\n\n\t\tmessage JWT {\n\t\t\trequired string contents = 1;\n\t\t\toptional int32 unknown2  = 2;\n\t\t}\n\t}\n\n  message Request {\n  \trequired RequestType request_type = 1;\n  \toptional bytes request_message = 2;\n\n    enum RequestType {\n    \tMETHOD_UNSET = 0;                     // No implementation required\n    \tPLAYER_UPDATE = 1;                    // Implemented [R & M]\n    \tGET_PLAYER = 2;                       // Implemented [R & M]\n    \tGET_INVENTORY = 4;                    // Implemented [R & M]\n    \tDOWNLOAD_SETTINGS = 5;                // Implemented [R & M]\n    \tDOWNLOAD_ITEM_TEMPLATES = 6;          // Implemented [R & M]\n    \tDOWNLOAD_REMOTE_CONFIG_VERSION = 7;   // Implemented [R & M]\n    \tFORT_SEARCH = 101;                    // Implemented [R & M]\n    \tENCOUNTER = 102;                      // Implemented [R & M]\n    \tCATCH_POKEMON = 103;                  // Implemented [R & M]\n    \tFORT_DETAILS = 104;                   // Implemented [R & M]\n    \tITEM_USE = 105;                       // Can't find this one\n    \tGET_MAP_OBJECTS = 106;                // Implemented [R & M]\n    \tFORT_DEPLOY_POKEMON = 110;            // Implemented [R & M]\n    \tFORT_RECALL_POKEMON = 111;            // Implemented [R & M]\n    \tRELEASE_POKEMON = 112;                // Implemented [R & M]\n    \tUSE_ITEM_POTION = 113;                // Implemented [R & M]\n    \tUSE_ITEM_CAPTURE = 114;               // Implemented [R & M]\n    \tUSE_ITEM_FLEE = 115;                  // Can't find this one\n    \tUSE_ITEM_REVIVE = 116;                // Implemented [R & M]\n    \tTRADE_SEARCH = 117;                   // Not yet implemented in the game\n    \tTRADE_OFFER = 118;                    // Not yet implemented in the game\n    \tTRADE_RESPONSE = 119;                 // Not yet implemented in the game\n    \tTRADE_RESULT = 120;                   // Not yet implemented in the game\n    \tGET_PLAYER_PROFILE = 121;             // Implemented [R & M]\n    \tGET_ITEM_PACK = 122;                  // Can't find this one\n    \tBUY_ITEM_PACK = 123;                  // Can't find this one\n    \tBUY_GEM_PACK = 124;                   // Can't find this one\n    \tEVOLVE_POKEMON = 125;                 // Implemented [R & M]\n    \tGET_HATCHED_EGGS = 126;               // Implemented [R & M]\n    \tENCOUNTER_TUTORIAL_COMPLETE = 127;    // Implemented [R & M]\n    \tLEVEL_UP_REWARDS = 128;               // Implemented [R & M]\n    \tCHECK_AWARDED_BADGES = 129;           // Implemented [R & M]\n    \tUSE_ITEM_GYM = 133;                   // Implemented [R & M]\n    \tGET_GYM_DETAILS = 134;                // Implemented [R & M]\n    \tSTART_GYM_BATTLE = 135;               // Implemented [R & M]\n    \tATTACK_GYM = 136;                     // Implemented [R & M]\n    \tRECYCLE_INVENTORY_ITEM = 137;         // Implemented [R & M]\n    \tCOLLECT_DAILY_BONUS = 138;            // Implemented [R & M]\n    \tUSE_ITEM_XP_BOOST = 139;              // Implemented [R & M]\n    \tUSE_ITEM_EGG_INCUBATOR = 140;         // Implemented [R & M]\n    \tUSE_INCENSE = 141;                    // Implemented [R & M]\n    \tGET_INCENSE_POKEMON = 142;            // Implemented [R & M]\n    \tINCENSE_ENCOUNTER = 143;              // Implemented [R & M]\n    \tADD_FORT_MODIFIER = 144;              // Implemented [R & M]\n    \tDISK_ENCOUNTER = 145;                 // Implemented [R & M]\n    \tCOLLECT_DAILY_DEFENDER_BONUS = 146;   // Implemented [R & M]\n    \tUPGRADE_POKEMON = 147;                // Implemented [R & M]\n    \tSET_FAVORITE_POKEMON = 148;           // Implemented [R & M]\n    \tNICKNAME_POKEMON = 149;               // Implemented [R & M]\n    \tEQUIP_BADGE = 150;                    // Implemented [R & M]\n    \tSET_CONTACT_SETTINGS = 151;           // Implemented [R & M]\n    \tGET_ASSET_DIGEST = 300;               // Implemented [R & M]\n    \tGET_DOWNLOAD_URLS = 301;              // Implemented [R & M]\n    \tGET_SUGGESTED_CODENAMES = 401;        // Implemented [R & M]\n    \tCHECK_CODENAME_AVAILABLE = 402;       // Implemented [R & M] TEST RESPONSE\n    \tCLAIM_CODENAME = 403;                 // Implemented [R & M] TEST RESPONSE\n    \tSET_AVATAR = 404;                     // Implemented [R & M]\n    \tSET_PLAYER_TEAM = 405;                // Implemented [R & M]\n    \tMARK_TUTORIAL_COMPLETE = 406;         // Implemented [R & M]\n    \tLOAD_SPAWN_POINTS = 500;              // Can't find this one\n    \tECHO = 666;                           // Implemented [R & M]\n    \tDEBUG_UPDATE_INVENTORY = 700;\n    \tDEBUG_DELETE_PLAYER = 701;\n    \tSFIDA_REGISTRATION = 800;             // Not yet released.\n    \tSFIDA_ACTION_LOG = 801;               // Not yet released.\n    \tSFIDA_CERTIFICATION = 802;            // Not yet released.\n    \tSFIDA_UPDATE = 803;                   // Not yet released.\n    \tSFIDA_ACTION = 804;                   // Not yet released.\n    \tSFIDA_DOWSER = 805;                   // Not yet released.\n    \tSFIDA_CAPTURE = 806;                  // Not yet released.\n    }\n  }\n}\n",
    "response": "message ResponseEnvelope {\n\trequired int32 status_code = 1;\n\trequired uint64 request_id = 2;\n\trequired string api_url = 3;\n\n\trequired Unknown6Response unknown6 = 6;\n\trequired AuthTicket auth_ticket = 7;\n\n\trepeated bytes returns = 100;\n\trequired string error = 101;\n\n  message Unknown6Response {\n  \trequired int32 unknown1 = 1; //6\n  \trequired Unknown2 unknown2 = 2;\n\n  \tmessage Unknown2 {\n  \t\trequired uint64 unknown1 = 1;\n  \t}\n  }\n\n  message AuthTicket {\n  \trequired bytes start = 1;\n  \trequired uint64 expire_timestamp_ms = 2;\n  \trequired bytes end = 3;\n  }\n\n\tmessage Unknown7 {\n\t\trequired bytes unknown71 = 1;\n\t\trequired int64 unknown72 = 2;\n\t\trequired bytes unknown73 = 3;\n\t}\n}\n",
    "request-map-objects": "message GetMapObjectsMessage {\n\trepeated uint64 cell_ids = 1 [packed=true];\n\trepeated int64 since_timestamp_ms = 2 [packed=true];\n\trequired double latitude = 3;\n\trequired double longitude = 4;\n}\n",
    "inventory": "message InventoryResponse {\n  required bool success = 1;\n  required InventoryDelta inventory_delta = 2;\n\n  message InventoryDelta {\n  \toptional int64 original_timestamp_ms = 1;\n  \toptional int64 new_timestamp_ms = 2;\n  \trepeated InventoryItem inventory_items = 3;\n\n    message InventoryItem {\n    \toptional int64 modified_timestamp_ms = 1;\n    \toptional int64 deleted_item_key = 2;\n    \toptional InventoryItemData inventory_item_data = 3;\n\n      message InventoryItemData {\n      \toptional PokemonData pokemon_data = 1;\n        optional Item item = 2;\n        optional PokedexEntry pokedex_entry = 3;\n        optional PlayerStats player_stats = 4;\n        optional PlayerCurrency player_currency = 5;\n        optional PlayerCamera player_camera = 6;\n        optional InventoryUpgrades inventory_upgrades = 7;\n        optional AppliedItems applied_items = 8;\n        optional EggIncubators egg_incubators = 9;\n        optional PokemonFamily pokemon_family = 10;\n\n        message PokemonData {\n        \toptional fixed64 id = 1;\n        \toptional int32 pokemon_id = 2;\n        \toptional int32 cp = 3;\n        \toptional int32 stamina = 4;\n        \toptional int32 stamina_max = 5;\n        \toptional int32 move_1 = 6;\n        \toptional int32 move_2 = 7;\n        \toptional int32 deployed_fort_id = 8;\n        \toptional string owner_name = 9;\n        \toptional bool is_egg = 10;\n        \toptional double egg_km_walked_target = 11;\n        \toptional double egg_km_walked_start = 12;\n        \toptional int32 origin = 14;\n        \toptional float height_m = 15;\n        \toptional float weight_kg = 16;\n        \toptional int32 individual_attack = 17;\n        \toptional int32 individual_defense = 18;\n        \toptional int32 individual_stamina = 19;\n        \toptional float cp_multiplier = 20;\n        \toptional int32 pokeball = 21;\n        \toptional uint64 captured_cell_id = 22;\n        \toptional int32 battles_attacked = 23;\n        \toptional int32 battles_defended = 24;\n        \toptional string egg_incubator_id = 25;\n        \toptional uint64 creation_time_ms = 26;\n        \toptional int32 num_upgrades = 27;\n        \toptional float additional_cp_multiplier = 28;\n        \toptional int32 favorite = 29;\n        \toptional string nickname = 30;\n        \toptional int32 from_fort = 31;\n        }\n\n        message Item {\n        \toptional int32 item_id = 1;\n        \toptional int32 count = 2;\n        \toptional bool unseen = 3;\n        }\n\n        message PokedexEntry {\n          optional int32 pokemon_id = 1;\n          optional int32 times_encountered = 2;\n          optional int32 times_captured = 3;\n          optional int32 evolution_stone_pieces = 4;\n          optional int32 evolution_stones = 5;\n        }\n\n        message PlayerStats {\n        \toptional int32 level = 1;\n        \toptional int64 experience = 2;\n        \toptional int64 prev_level_xp = 3;\n        \toptional int64 next_level_xp = 4;\n        \toptional float km_walked = 5;\n        \toptional int32 pokemons_encountered = 6;\n        \toptional int32 unique_pokedex_entries = 7;\n        \toptional int32 pokemons_captured = 8;\n        \toptional int32 evolutions = 9;\n        \toptional int32 poke_stop_visits = 10;\n        \toptional int32 pokeballs_thrown = 11;\n        \toptional int32 eggs_hatched = 12;\n        \toptional int32 big_magikarp_caught = 13;\n        \toptional int32 battle_attack_won = 14;\n        \toptional int32 battle_attack_total = 15;\n        \toptional int32 battle_defended_won = 16;\n        \toptional int32 battle_training_won = 17;\n        \toptional int32 battle_training_total = 18;\n        \toptional int32 prestige_raised_total = 19;\n        \toptional int32 prestige_dropped_total = 20;\n        \toptional int32 pokemon_deployed = 21;\n        \toptional bytes pokemon_caught_by_type = 22; // TODO: repeated PokemonType ??\n        \toptional int32 small_rattata_caught = 23;\n        }\n\n        message PlayerCurrency {\n          optional int32 gems = 1;\n        }\n\n        message PlayerCamera {\n        \toptional bool is_default_camera = 1;\n        }\n\n        message InventoryUpgrades {\n        \trepeated InventoryUpgrade inventory_upgrades = 1;\n\n          message InventoryUpgrade {\n          \toptional int32 item_id = 1;\n          \toptional int32 upgrade_type = 2;\n          \toptional int32 additional_storage = 3;\n          }\n        }\n\n        message AppliedItems {\n        \trepeated AppliedItem item = 4;\n\n          message AppliedItem {\n          \toptional int32 item_id = 1;\n          \toptional int32 item_type = 2;\n          \toptional int64 expire_ms = 3;\n          \toptional int64 applied_ms = 4;\n          }\n        }\n\n        message EggIncubators {\n        \trepeated EggIncubator egg_incubator = 1;\n\n          message EggIncubator {\n          \toptional string id = 1;\n          \toptional int32 item_id = 2;\n          \toptional int32 incubator_type = 3;\n          \toptional int32 uses_remaining = 4;\n          \toptional uint64 pokemon_id = 5; // TODO: Check if is PokemonType\n          \toptional double start_km_walked = 6;\n          \toptional double target_km_walked = 7;\n          }\n        }\n\n        message PokemonFamily {\n        \toptional int32 family_id = 1;\n        \toptional int32 candy = 2;\n        }\n      }\n    }\n  }\n}\n",
    "response-map-objects": "message GetMapObjectsResponse {\n\trepeated MapCell map_cells = 1;\n\toptional int32 status = 2;\n\n  message MapCell {\n  \t// S2 geographic area that the cell covers (http://s2map.com/) (https://code.google.com/archive/p/s2-geometry-library/)\n  \toptional uint64 s2_cell_id = 1;\n  \toptional int64 current_timestamp_ms = 2;\n    repeated FortData forts = 3;\n    repeated SpawnPoint spawn_points = 4;\n    repeated string deleted_objects = 6;\n    optional bool is_truncated_list = 7;\n    repeated FortSummary fort_summaries = 8;\n    repeated SpawnPoint decimated_spawn_points = 9;\n\n    // Pokemon within 2 steps or less.\n\t  repeated WildPokemon wild_pokemon = 5;\n\n    // Pokemon within 1 step or none.\n\t  repeated MapPokemon catchable_pokemon = 10;\n\n    // Pokemon farther away than 2 steps, but still in the area.\n\t  repeated NearbyPokemon nearby_pokemon = 11;\n\n    message FortData {\n    \toptional string id = 1;\n    \toptional int64 last_modified_timestamp_ms = 2;\n    \toptional double latitude = 3;\n    \toptional double longitude = 4;\n    \toptional bool enabled = 8;\n    \toptional int32 type = 9;\n\n      // team that owns the gym\n      optional int32 owned_by_team = 5;\n\n    \t// highest cp pokemon at the gym\n    \toptional int32 guard_pokemon_id = 6;\n    \toptional int32 guard_pokemon_cp = 7;\n\n    \t// prestige (or experience) of the gym\n    \toptional int64 gym_points = 10;\n\n    \t// Whether someone is battling at the gym currently\n    \toptional bool is_in_battle = 11;\n\n    \t// Timestamp when the pokestop can be activated again to get items / xp\n    \toptional int64 cooldown_complete_timestamp_ms = 14;\n\n    \toptional int32 sponsor = 15;\n    \toptional int32 rendering_type = 16;\n\n    \t// Might represent the type of item applied to the pokestop, right now only lures can be applied\n    \toptional bytes active_fort_modifier = 12;\n    \toptional FortLureInfo lure_info = 13;\n\n      message FortLureInfo {\n      \toptional string fort_id = 1;\n      \toptional fixed64 encounter_id = 2;\n      \toptional int32 active_pokemon_id = 3;\n      \toptional int64 lure_expires_timestamp_ms = 4;\n      }\n    }\n\n    message SpawnPoint {\n    \toptional double latitude = 2;\n    \toptional double longitude = 3;\n    }\n\n    message FortSummary {\n    \toptional int32 fort_summary_id = 1;\n    \toptional int32 last_modified_timestamp_ms = 2;\n    \toptional int32 latitude = 3;\n    \toptional int32 longitude = 4;\n    }\n\n    message WildPokemon {\n    \toptional fixed64 encounter_id = 1;\n    \toptional int64 last_modified_timestamp_ms = 2;\n    \toptional double latitude = 3;\n    \toptional double longitude = 4;\n    \toptional string spawn_point_id = 5;\n    \toptional PokemonData pokemon_data = 7;\n    \toptional int32 time_till_hidden_ms = 11;\n\n      message PokemonData {\n      \toptional fixed64 id = 1;\n      \toptional int32 pokemon_id = 2;\n      \toptional int32 cp = 3;\n      \toptional int32 stamina = 4;\n      \toptional int32 stamina_max = 5;\n      \toptional int32 move_1 = 6;\n      \toptional int32 move_2 = 7;\n      \toptional int32 deployed_fort_id = 8;\n      \toptional string owner_name = 9;\n      \toptional bool is_egg = 10;\n      \toptional double egg_km_walked_target = 11;\n      \toptional double egg_km_walked_start = 12;\n      \toptional int32 origin = 14;\n      \toptional float height_m = 15;\n      \toptional float weight_kg = 16;\n      \toptional int32 individual_attack = 17;\n      \toptional int32 individual_defense = 18;\n      \toptional int32 individual_stamina = 19;\n      \toptional float cp_multiplier = 20;\n      \toptional int32 pokeball = 21;\n      \toptional uint64 captured_cell_id = 22;\n      \toptional int32 battles_attacked = 23;\n      \toptional int32 battles_defended = 24;\n      \toptional string egg_incubator_id = 25;\n      \toptional uint64 creation_time_ms = 26;\n      \toptional int32 num_upgrades = 27;\n      \toptional float additional_cp_multiplier = 28;\n      \toptional int32 favorite = 29;\n      \toptional string nickname = 30;\n      \toptional int32 from_fort = 31;\n      }\n    }\n\n    message NearbyPokemon {\n    \toptional int32 pokemon_id = 1;\n    \toptional float distance_in_meters = 2;\n    \toptional fixed64 encounter_id = 3;\n    }\n\n    message MapPokemon {\n    \toptional string spawn_point_id = 1;\n    \toptional fixed64 encounter_id = 2;\n    \toptional int32 pokemon_id = 3;\n    \t// After this timestamp, the pokemon will be gone.\n    \toptional int64 expiration_timestamp_ms = 4;\n    \toptional double latitude = 5;\n    \toptional double longitude = 6;\n    }\n  }\n}\n",
    "profile": "message ProfileResponse {\n  repeated int32 unknown1 = 1;\n  required Profile profile = 2;\n\n  message Profile {\n    required int64 creation_timestamp_ms  = 1;\n    required string username = 2;\n    required int32 team = 5;\n    repeated TutorialState tutorial_state = 7 [packed=true];\n    required PlayerAvatar avatar = 8;\n  \trequired int32 max_pokemon_storage = 9;\n  \trequired int32 max_item_storage = 10;\n  \trequired DailyBonus daily_bonus = 11;\n  \trequired EquippedBadge equipped_badge = 12;\n    required ContactSettings contact_settings = 13;\n\t  repeated Currency currencies = 14;\n\n    enum TutorialState {\n    \tLEGAL_SCREEN = 0;\n    \tAVATAR_SELECTION = 1;\n    \tACCOUNT_CREATION = 2;\n    \tPOKEMON_CAPTURE = 3;\n    \tNAME_SELECTION = 4;\n    \tPOKEMON_BERRY = 5;\n    \tUSE_ITEM = 6;\n    \tFIRST_TIME_EXPERIENCE_COMPLETE = 7;\n    \tPOKESTOP_TUTORIAL = 8;\n    \tGYM_TUTORIAL = 9;\n    }\n\n    message PlayerAvatar {\n    \toptional int32 skin = 2;\n    \toptional int32 hair = 3;\n    \toptional int32 shirt = 4;\n    \toptional int32 pants = 5;\n    \toptional int32 hat = 6;\n    \toptional int32 shoes = 7;\n    \toptional int32 gender = 8;\n    \toptional int32 eyes = 9;\n    \toptional int32 backpack = 10;\n    }\n\n    message DailyBonus {\n    \toptional int64 next_collected_timestamp_ms = 1;\n    \toptional int64 next_defender_bonus_collect_timestamp_ms = 2;\n    }\n\n    message EquippedBadge {\n    \toptional int32 badge_type = 1;\n    \toptional int32 level = 2;\n    \toptional int64 next_equip_change_allowed_timestamp_ms = 3;\n    }\n\n    message ContactSettings {\n    \toptional bool send_marketing_emails = 1;\n    \toptional bool send_push_notifications = 2;\n    }\n\n    message Currency {\n      optional string name = 1;\n      optional int32 amount = 2;\n    }\n  }\n}\n"
  };

  /* @ng-inject */
  function PokemonRequest($http, $q, userService, ionicToast, $rootScope, $timeout) {

    var protobuf = dcodeIO.ProtoBuf;
    var protos = {};
    _.forEach(protoStrings, function (value, key) {
      protos[key] = protobuf.loadProto(value).build();
    });
    var Envelope = protos.request.RequestEnvelope;

    var self = this;
    var api_url = "https://pgorelease.nianticlabs.com/plfe/rpc";
    self.api_url = null;


    $rootScope.$on('userLogout', function () {
      self.api_url = null;
    });

    self.alert = function (message) {
      self.state = message;
      ionicToast.hide();
      ionicToast.show(message, 'bottom', false, 3000);
    };

    this.getInventoryData = function () {
      self.alert('포켓몬 데이터를 요청합니다.');
      if (window.AdMob) {
        $timeout(function () {
          window.AdMob.showInterstitial();
        }, 1500);
      }
      userService.updatePosition();
      return $q(function (ok, no) {
        updateEndPoint().then(function () {
          self.alert('포켓몬 데이터를 가져오는 중입니다.');
          sendRequest('GET_INVENTORY').then(function (data) {
            var inventoryPayload = data.returns[0];
            try {
              var decoded = protos.inventory.InventoryResponse.decode(inventoryPayload);
              ok(decoded.inventory_delta.inventory_items);
              self.alert('포켓몬 데이터를 가져왔습니다.');
              self.state = '';
            }
            catch (e) {
              self.state = '';
            }

          }, function () {
            self.alert('포켓몬 데이터를 가져오지 못했습니다.');
            no();
          });
        });
      });
    };

    function updateEndPoint() {
      return $q(function (ok) {
        if (!self.api_url) {
          sendRequest('GET_PLAYER').then(function (response) {
            if (response.api_url) {
              self.api_url = "https://" + response.api_url + "/rpc";
              ok();
            }
          });
        }
        else
          ok();
      });
    }

    function sendRequest(request) {
      return $q(function (ok, no) {
        $q.all([userService.getToken().then(function (token) {
          return token;
        }), userService.getLatLng().then(function (latlng) {
          return latlng;
        })]).then(function (result) {
          var requests = [new Envelope.Request(Envelope.Request.RequestType[request])];
          var envelop = new Envelope({
            status_code: 2,
            request_id: 1469378659230941192,
            requests: requests,
            latitude: result[1].lat,
            longitude: result[1].lng,
            altitude: 0,
            auth_info: new Envelope.AuthInfo({
              provider: 'google',
              token: new Envelope.AuthInfo.JWT(result[0], 59)
            }),
            unknown12: 989
          });
          var buffer = envelop.encode().toBuffer();
          $http({
            url: self.api_url || api_url,
            responseType: 'arraybuffer',
            transformRequest: [],
            method: "POST",
            data: buffer
          }).then(function (data) {
            try {
              ok(protos.response.ResponseEnvelope.decode(data.data));
            } catch (error) {
              if (error.decoded) {
                ok(error.decoded);
                return;
              }
              no();
            }
          }, no);
        });
      });
    }

  }
})();

